FM radio based on Raspberry Pi Pico + RDA5807 + UC1609C + NS8002 + KCX_BT_EMITTER + EC11 encoder

#################################################
#
#            picoFM - FM Radio
#
#################################################


## Состав рабочего оборудования:

```
* RDA5807, RF receiver FM
* Raspberry Pi Pico (Waveshare-Zero board)
* UC1609C LCD display 192x64
* NS8002 chip - 3W Class-D audio amplifier
* speaker 8 Om 3 W
* KCX_BT_EMITTER - bluetooth audio transmitter
* EC11 - rotary encoder
```


# Средства разработки:

```
* pico-sdk - sdk development applications for Raspberry Pi Pico
  (https://github.com/raspberrypi/pico-sdk, https://raspberrypi.github.io/pico-sdk-doxygen/index.html)
* Eclipse IDE for Embedded C/C++ - IDE software development environment
  (https://www.eclipse.org/)
* pico-project-generator-master - python script for create project for Raspberry Pi Pico
```


# Функционал:
* Устройство предназначено для прослушивания радиостанций ФМ диапазона (65 - 108 Мгц),
  а также приема и отображения информации RDS от радиостанций FM диапазона.
* ПО построено с использованием программных средств SDK 'pico-sdk'.
  События обслуживаются в основном цикле программы. Формируются события, как правило, в callBack-функциях
  по завершении прерываний от используемых модулей микроконтроллера.
* Устройство инициализирует некоторые интерфейсы микроконтроллера :
  - ADC : Chan0(GP26) и Chan1(GP27) аналогово-цифровой преобразователь (измеряет напряжение на аналоговых выходах джойстика).
  - GPIO : подключены три светодиода : GP29 - секундный тик, GP4,GP5,GP6,GP7 (DC,RST,SCK,MOSI) - пины интерфейса
           SPI0, GP15 - пин обслуживает кнопку джойстка/переключателя в режиме прерывания,
           GP10,GP11,GP12 - обслуживают энкодер EC11 в режиме прерывания.
  - I2C1 : режим мастера с частотой 400Кгц (шина ослуживает чипы rda5807).
  - SPI0 : режим мастера с частотой 3Мгц (шина ослуживает LCD display UC1609C).
  - UART0 : параметры порта 230400 8N1 - порт для логов и передачи команд устройству.
  - UART1 : параметры порта 9600 8N1 - порт для обслуживания bluetooth device KCX_BT_EMITTER.
  - Core1 задействовано для обслуживания джойстика/переключателя.

* Прием данных по последовательному порту (UART0) выполняется в callback-функции обработчика прерывания.

После подачи питания или нажатия на кнопку 'Reset' начинается выполнение загрузчика.
При успешном запуске в порту UART0 появятся следующие сообщения :


```
27.09.22 19:39:37 | Start picoRadio app Ver.3.5 27.09.22
        BoardID:E66138935F374B29
        Temp:30.88 deg.C
27.09.22 19:39:37 | All clocks are set to:
        pll_sys : 0 kHz
        pll_usb : 48000 kHz
        rosc    : 5730 kHz
        clk_sys : 48000 kHz
        clk_peri: 48000 kHz
        clk_usb : 48000 kHz
        clk_adc : 48000 kHz
        clk_rtc : 47 kHz
27.09.22 19:39:37 | Create queue for 32 events OK
27.09.22 19:39:37 | Start timer with 5 ms period.
27.09.22 19:39:38 | RDA5807 cID:0x58
27.09.22 19:39:38 | Start 'joystik_task' function on Core1
27.09.22 19:39:38 | [BLE_TX] AT+REST
27.09.22 19:39:38 | [que:2] RDS monitoring start
27.09.22 19:39:38 | [que:1] set new Freq to 95.1 МГц 'Вести ФМ' Chan:191 Volume:8
27.09.22 19:39:38 | [BLE_RX] OK+REST
27.09.22 19:39:39 | [BLE_RX] POWER ON
27.09.22 19:39:39 | [BLE_RX] Delete_Vmlink
...
...
...
27.09.22 19:41:39 | [BLE_RX] ALL Devices=0
27.09.22 19:41:51 | [BLE_RX] ALL Devices=1
27.09.22 19:41:51 | [BLE_RX] MacAddr=0x414269d40b57,Name=S650
27.09.22 19:41:53 | [BLE_RX] CONNECTED to device Mac:0x414269d40b57 Name:S650
27.09.22 19:41:59 | [BLE_RX] opid:0x44C4 'VolumeUp'
27.09.22 19:41:59 | [que:1] set new Volume to 9
27.09.22 19:42:02 | [BLE_RX] opid:0x46C6 'VolumeDown'
27.09.22 19:42:02 | [que:1] set new Volume to 8
27.09.22 19:42:03 | [BLE_RX] ALL Devices=1
27.09.22 19:42:03 | [BLE_RX] MacAddr=0x414269d40b57,Name=S650
27.09.22 19:42:10 | [BLE_RX] DISCONNECT from device Mac:0x414269d40b57 Name:S650
27.09.22 19:42:10 | [BLE_TX] AT+REST
27.09.22 19:42:10 | [BLE_RX] OK+REST
27.09.22 19:42:11 | [BLE_RX] POWER ON
27.09.22 19:42:12 | [BLE_RX] Delete_Vmlink
```

* Через UART0 можно отправлять команды на устройство, например :

```
ver
07.09.22 22:31:05 | [que:1] cmd:3 attr:0
07.09.22 22:31:05 | Ver.2.9 07.09.22 encoder

read:0
Read sector:0 offset:0 len:512 fadr:0x10000000
10000000 00 B5 32 4B 21 20 58 60 98 68 02 21 88 43 98 60 ...2K! X`.h.!.C.
10000010 D8 60 18 61 58 61 2E 4B 00 21 99 60 02 21 59 61 `.`.aXa.K.!.`.!Y
10000020 01 21 F0 22 99 50 2B 49 19 60 01 21 99 60 35 20 a.!.".P+I.`.!.`5
10000030 00 F0 44 F8 02 22 90 42 14 D0 06 21 19 66 00 F0  ..D..".B...!.f.
10000040 34 F8 19 6E 01 21 19 66 00 20 18 66 1A 66 00 F0 .4..n.!.f. .f.f.
10000050 2C F8 19 6E 19 6E 19 6E 05 20 00 F0 2F F8 01 21 .,..n.n.n. ../..
10000060 08 42 F9 D1 00 21 99 60 1B 49 19 60 00 21 59 60 !.B...!.`.I.`.!Y
10000070 1A 49 1B 48 01 60 01 21 99 60 EB 21 19 66 A0 21 `.I.H.`.!.`.!.f.
10000080 19 66 00 F0 12 F8 00 21 99 60 16 49 14 48 01 60 !.f.....!.`.I.H.
10000090 01 21 99 60 01 BC 00 28 00 D0 00 47 12 48 13 49 `.!.`...(...G.H.
100000A0 08 60 03 C8 80 F3 08 88 08 47 03 B5 99 6A 04 20 I.`.......G...j.
100000B0 01 42 FB D0 01 20 01 42 F8 D1 03 BD 02 B5 18 66  .B... .B.......
100000C0 18 66 FF F7 F2 FF 18 6E 18 6E 02 BD 00 00 02 40 f.f.....n.n.....
100000D0 00 00 00 18 00 00 07 00 00 03 5F 00 21 22 00 00 @.........._.!".
100000E0 F4 00 00 18 22 20 00 A0 00 01 00 10 08 ED 00 E0 ....." .........
100000F0 00 00 00 00 00 00 00 00 00 00 00 00 74 B2 4E 7A .............t.N
10000100 00 20 04 20 F7 01 00 10 C3 01 00 10 C5 01 00 10 z. . ...........
10000110 C1 01 00 10 C1 01 00 10 C1 01 00 10 C1 01 00 10 ................
10000120 C1 01 00 10 C1 01 00 10 C1 01 00 10 C7 01 00 10 ................
10000130 C1 01 00 10 C1 01 00 10 C9 01 00 10 CB 01 00 10 ................
10000140 CD 01 00 10 CD 01 00 10 CD 01 00 10 CD 01 00 10 ................
10000150 CD 01 00 10 CD 01 00 10 CD 01 00 10 CD 01 00 10 ................
10000160 CD 01 00 10 CD 01 00 10 CD 01 00 10 CD 01 00 10 ................
10000170 CD 01 00 10 CD 01 00 10 CD 01 00 10 CD 01 00 10 ................
10000180 CD 01 00 10 CD 01 00 10 CD 01 00 10 CD 01 00 10 ................
10000190 CD 01 00 10 CD 01 00 10 CD 01 00 10 CD 01 00 10 ................
100001A0 CD 01 00 10 CD 01 00 10 CD 01 00 10 CD 01 00 10 ................
100001B0 CD 01 00 10 CD 01 00 10 CD 01 00 10 CD 01 00 10 ................
100001C0 00 BE 00 BE 00 BE 00 BE 00 BE 00 BE 00 F0 4B F8 ...............K
100001D0 10 38 00 BE F2 EB 88 71 FC 43 01 10 34 44 01 10 ..8.....q.C..4D.
100001E0 34 02 00 10 90 A3 1A E7 00 20 21 49 08 60 06 C8 .4........ !I.`.
100001F0 81 F3 08 88 10 47 1F 48 00 68 00 28 2F D1 0D A4 ......G.H.h.(/..
next
Read sector:0 offset:512 len:512 fadr:0x10000200
10000200 0E CC 00 29 02 D0 00 F0 12 F8 F9 E7 1A 49 1B 4A ....).........I.
10000210 00 20 00 E0 01 C1 91 42 FC D1 19 49 88 47 19 49 J. .....B...I.G.
10000220 88 47 19 49 88 47 00 BE FD E7 01 C9 01 C2 9A 42 I.G.I.G.........
10000230 FB D3 70 47 34 44 01 10 C0 00 00 20 60 10 00 20 B..pG4D..... `..
10000240 D4 53 01 10 00 00 04 20 00 00 04 20 D4 53 01 10  .S..... ... .S.
10000250 00 10 04 20 00 10 04 20 00 00 00 00 70 47 0B 48 .... ... ....pG.
10000260 07 F0 84 FE 00 47 EF F3 05 80 C0 B2 70 47 00 00 H.....G......pG.
10000270 08 ED 00 E0 00 00 00 D0 60 10 00 20 98 3A 00 20 .........`.. .:.
10000280 C9 5D 00 10 DD 11 00 10 ED 5E 00 10 57 56 00 00  .].......^..WV.
10000290 06 00 52 50 AB B3 60 53 64 3C 01 10 06 00 52 50 ...RP..`Sd<....R
100002A0 86 1C 03 02 74 3C 01 10 06 00 52 50 54 22 A2 9D P....t<....RPT".
100002B0 7C 3C 01 10 05 00 52 50 DE 65 F4 68 D4 53 01 10 .|<....RP.e.h.S.
100002C0 F8 B5 C0 46 04 48 05 4B 10 B5 83 42 03 D0 04 4B ....F.H.K...B...
100002D0 00 2B 00 D0 98 47 10 BD 60 10 00 20 60 10 00 20 K.+...G..`.. `..
100002E0 00 00 00 00 06 48 07 49 09 1A 8B 10 C9 0F C9 18  .....H.I.......
100002F0 10 B5 49 10 03 D0 04 4B 00 2B 00 D0 98 47 10 BD ...I....K.+...G.
10000300 60 10 00 20 60 10 00 20 00 00 00 00 10 B5 07 4C .`.. `.. .......
10000310 23 78 00 2B 09 D1 FF F7 D5 FF 05 4B 00 2B 02 D0 L#x.+.......K.+.
10000320 04 48 00 E0 00 BF 01 23 23 70 10 BD 68 11 00 20 ..H.....##p..h..
10000330 00 00 00 00 48 FD 00 10 05 4B 10 B5 00 2B 03 D0  ....H....K...+.
10000340 04 49 05 48 00 E0 00 BF FF F7 CC FF 10 BD C0 46 ..I.H...........
10000350 00 00 00 00 6C 11 00 20 48 FD 00 10 C3 4B F0 B5 F....l.. H....K.
10000360 DE 46 9B 46 57 46 01 23 5A 46 4E 46 45 46 E0 21 ..F.FWF.#ZFNFEF.
10000370 E0 B5 13 70 BE 4A C9 01 13 68 87 B0 0B 40 BD 49 !...p.J...h...@.
10000380 0B 60 04 21 BC 4B 19 60 FC 31 13 68 0B 42 FC D0 I.`.!.K.`.1.h.B.
10000390 53 68 80 23 12 68 5B 01 53 40 E0 22 D2 01 13 40 .Sh.#.h[.S@."...
100003A0 B4 4A 80 21 13 60 04 22 B3 4B 49 00 1A 60 B0 4A @.J.!.`.".KI..`.
100003B0 13 68 0B 42 FC D0 53 68 B0 4B 01 20 1A 00 B0 49 J.h.B..Sh.K. ...
100003C0 9A 46 02 F0 13 FD 02 20 02 F0 C4 FC AD 4D 04 00 I.F..... .....M.
100003D0 AD 4F 04 E0 20 00 02 F0 C3 FC 00 28 11 D1 2B 78 ..O.. ......(..+
100003E0 00 2B F7 D0 52 46 01 20 A8 49 02 F0 FF FC 00 23 x.+..RF. .I.....
100003F0 5A 46 13 70 07 B0 3C BC 90 46 99 46 A2 46 AB 46 #ZF.p..<..F.F.F.

help
07.09.22 22:29:49 | [que:1] cmd:0 attr:0
        help
        restart
        epoch:
        ver
        input_err
        clr
        uart
        mute
        sec
        temp
        enc
        encinc
        encdec
        cfg
        scan
        vol:
        bass:
        band:
        freq:
        list
        rds
        showfreq
        read
        readcont
        next
        check
        ble

epoch:1662032931
01.09.22 11:48:52 | [que:1] cmd:2 attr:1662032931

mute
01.09.22 11:49:29 | [que:1] cmd:7 attr:0
01.09.22 11:49:29 | [que:1] set Mute to 1
mute
01.09.22 11:49:31 | [que:1] cmd:7 attr:0
01.09.22 11:49:31 | [que:1] set Mute to 0

scan
01.09.22 11:50:35 | [que:1] set new Freq to 95.500 МГц Ретро ФМ Chan:195 Volume:6 idx=6

list
01.09.22 11:51:15 | Band = newBand = 2 -> goto set newFreq to 95.500 (up = 1)
01.09.22 11:51:15 | [que:1] set new Freq to 95.500 МГц 'Ретро ФМ' Chan:195 Volume:6 idx=6

vol:up
01.09.22 11:51:48 | [que:1] set new Volume to 7
vol:down
01.09.22 11:51:53 | [que:1] set new Volume to 6

freq:105.9
01.09.22 11:52:23 | [que:1] set new Freq to 105.900 МГц 'Дорожное Радио' Chan:299 Volume:6 idx=23

rds
01.09.22 11:52:47 | [que:1] RDS monitoring stop
rds
01.09.22 11:52:50 | [que:1] RDS monitoring start

bass:1
01.09.22 11:53:17 | [que:1] set new BassBoost to 1
bass:0
01.09.22 11:53:21 | [que:1] set new BassBoost to 0

cfg
3:68.5:Маяк
3:72.1:Шансон
2:92.8:Радио DFM
2:93.6:Радио 7
2:94.0:Комеди Радио
2:95.1:Вести ФМ
2:95.5:Ретро ФМ
2:96.3:Русское Радио
2:97.0:Радио Вера
2:97.7:Серебр.Дождь
2:98.5:Радио Энергия
2:99.5:Радио Звезда
2:100.1:Авто Радио
2:100.6:Русский Край
2:100.9:Монте-Карло
2:101.3:Наше Радио
2:101.8:Бизнес ФМ
2:102.5:Маяк
2:102.9:Ўбимое Радио
2:103.4:Студия 21
2:103.9:Радио России
2:104.5:Европа Плюс
2:105.2:Балтик Плюс
2:105.9:Дорожное Радио
2:106.4:Радио Максим
2:107.2:Радио КП

temp
01.09.22 11:54:29 | [que:1] onchip temperature:30.88 deg.C

01.09.22 11:55:13 | Band = newBand = 2 -> goto set newFreq to 95.100 (up = 0)
01.09.22 11:55:13 | [que:1] set new Freq to 95.100 МГц 'Вести ФМ' Chan:191 Volume:5 idx=5

restart
27.09.22 19:43:42 | [que:1] cmd:1 attr:0
27.09.22 19:43:42 | Queue released
227.09.22 19:43:42 | Timer cancelled... 1

27.09.22 19:39:37 | Start picoRadio app Ver.3.5 27.09.22
        BoardID:E66138935F374B29
        Temp:31.82 deg.C
27.09.22 19:39:37 | All clocks are set to:
        pll_sys : 0 kHz
        pll_usb : 48000 kHz
        rosc    : 5731 kHz
        clk_sys : 48000 kHz
        clk_peri: 48000 kHz
        clk_usb : 48000 kHz
        clk_adc : 48000 kHz
        clk_rtc : 47 kHz
27.09.22 19:39:37 | Create queue for 32 events OK
27.09.22 19:39:37 | Start timer with 5 ms period.
27.09.22 19:39:38 | RDA5807 cID:0x58
27.09.22 19:39:38 | Start 'joystik_task' function on Core1
27.09.22 19:39:38 | [BLE_TX] AT+REST
27.09.22 19:39:38 | [que:2] RDS monitoring start
27.09.22 19:39:38 | [que:1] set new Freq to 95.1 МГц 'Вести ФМ' Chan:191 Volume:8
27.09.22 19:39:38 | [BLE_RX] OK+REST
27.09.22 19:39:39 | [BLE_RX] POWER ON
27.09.22 19:39:39 | [BLE_RX] Delete_Vmlink
```
